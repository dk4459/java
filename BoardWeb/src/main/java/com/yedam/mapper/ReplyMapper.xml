<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.yedam.mapper.ReplyMapper">

  <select id="replyList" parameterType="int" resultType="com.yedam.vo.ReplyVO">
  	SELECT tbl_a.*
  	FROM (SELECT /*+ INDEX_DESC (r PK_REPLY)*/
  		 rownum rn,reply_no,reply,replyer,board_no,reply_date 
  		  FROM tbl_reply r
  		  WHERE board_no=#{boardNo}) tbl_a 
  	WHERE tbl_a.rn >=(#{page}-1)*5+1
  	AND tbl_a.rn<![CDATA[<=]]> #{page} * 5
  </select>
  
  <select id="totalPage" resultType="int" parameterType="int">
  	SELECT COUNT(1) cnt 
  	FROM tbl_reply 
  	WHERE board_no= #{boardNo}
  </select>
  
  <select id="selectReply" resultType="com.yedam.vo.ReplyVO" parameterType="int">
  	SELECT reply_no, reply,replyer,board_no
  	FROM tbl_reply 
  	WHERE reply_no = #{rno}
  </select>
  <insert id="insertReply" parameterType="com.yedam.vo.ReplyVO">
  	<selectKey keyProperty="replyNo" resultType="int" order="BEFORE">
	    	SELECT reply_seq.nextval 
  			FROM dual
	</selectKey>
  		INSERT INTO tbl_reply(reply_no, reply,replyer, board_no)
  		VALUES(#{replyNo},#{reply},#{replyer},#{boardNo})
  </insert>
  
  <delete id="deleteReply" parameterType="int">
  		DELETE FROM tbl_reply 
  		WHERE reply_no = #{replyNo} 
  </delete>
  <select id="chartData" resultType="map">
  	SELECT e.department_id,
  			d.department_name,
  			 count(*) cnt 
  	FROM employees e JOIN departments d 
  					   ON(e.department_id=d.department_id) 
  	GROUP BY e.department_id, 
  	     	 d.department_name
  </select>
</mapper>